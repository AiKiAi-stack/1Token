# 1Token - API Token ä¿é™©åº“

> **é¡¹ç›®æ„¿æ™¯**ï¼šä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªå®‰å…¨ã€ä¾¿æ·çš„ API Token ç®¡ç†å·¥å…·ï¼Œè§£å†³ã€ŒToken åˆ†æ•£ã€æ˜“è¿‡æœŸã€éš¾ç®¡ç†ã€çš„ç—›ç‚¹ã€‚

---

## ğŸ›  æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ ˆ

- **Frontend/Backend:** Next.js 15 (App Router) - å…¨æ ˆæ¡†æ¶ï¼ŒServer Actions å¤„ç†ä¸šåŠ¡é€»è¾‘
- **UI ç»„ä»¶:** Shadcn UI + Tailwind CSS - ç°ä»£ã€æç®€è®¾è®¡
- **æ•°æ®åº“:** SQLite (via Prisma ORM) - æœ¬åœ°åŒ–å­˜å‚¨ï¼Œè½»é‡æ˜“å¤‡ä»½
- **åŠ å¯†:** Node.js `crypto` (AES-256-GCM) - ç«¯åˆ°ç«¯åŠ å¯†
- **ä»»åŠ¡è°ƒåº¦:** node-cron - æœ¬åœ°å®šæ—¶ä»»åŠ¡
- **é‚®ä»¶æœåŠ¡:** Resend API - ç®€æ´çš„é‚®ä»¶å‘é€æœåŠ¡

### å¼€å‘å·¥å…·

- **åŒ…ç®¡ç†:** pnpm
- **ç±»å‹æ£€æŸ¥:** TypeScript
- **ä»£ç è§„èŒƒ:** ESLint + Prettier
- **æµ‹è¯•:** Vitest + Playwright

---

## ğŸš€ å¼€å‘è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒä¿é™©åº“ (MVP)

**ç›®æ ‡**ï¼šå®ç° Token çš„å®‰å…¨å­˜å‚¨ä¸æŸ¥çœ‹

#### 1.1 é¡¹ç›®åˆå§‹åŒ–

- [ ] ä½¿ç”¨ `pnpm create next-app` åˆ›å»º Next.js 15 é¡¹ç›®
- [ ] é…ç½® TypeScriptã€ESLintã€Prettier
- [ ] å®‰è£…å¹¶é…ç½® Prisma + SQLite
- [ ] å®‰è£… Shadcn UI ç»„ä»¶åº“

#### 1.2 å®‰å…¨æ¶æ„

- [ ] å®ç° Master Password éªŒè¯æµç¨‹ï¼ˆbcrypt å“ˆå¸Œ + saltï¼‰
- [ ] ç¼–å†™åŠ å¯†/è§£å¯†å·¥å…·å‡½æ•°ï¼ˆAES-256-GCMï¼‰
- [ ] å®ç°åŸºäº Session çš„å¯†é’¥æ´¾ç”Ÿæœºåˆ¶
- [ ] è®¾è®¡å‰ç«¯æ˜Ÿå·é®è”½ UIï¼ˆç‚¹å‡»/å¤åˆ¶æ—¶è§£å¯†ï¼‰

#### 1.3 åŸºç¡€ CRUD

- [ ] Token è¡¨å•ï¼šPlatform Name, Token Value, Purpose, Scopes, Expires At
- [ ] Token åˆ—è¡¨é¡µï¼šæ”¯æŒå¤åˆ¶ã€ç¼–è¾‘ã€åˆ é™¤
- [ ] æ·»åŠ  Token æ—¶æ”¯æŒé¢„è®¾æ¨¡æ¿ï¼ˆGitHub 90 å¤©ã€PyPI æ°¸ä¹…ç­‰ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š

- ç”¨æˆ·å¯ä»¥åˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ Token
- æ‰€æœ‰ Token åœ¨æ•°æ®åº“ä¸­ä¸ºåŠ å¯†çš„ Base64 å­—ç¬¦ä¸²
- ç•Œé¢é»˜è®¤é®è”½ Tokenï¼Œæ”¯æŒä¸€é”®å¤åˆ¶

---

### Phase 2: æ™ºèƒ½ç®¡ç†ä½“éªŒ

**ç›®æ ‡**ï¼šè®©å·¥å…·æ¯”ã€Œè®°äº‹æœ¬ã€æ›´é«˜æ•ˆ

#### 2.1 å¯è§†åŒ–çŠ¶æ€

- [ ] è¿‡æœŸæ—¶é—´å€’è®¡æ—¶ç»„ä»¶
- [ ] çŠ¶æ€é¢œè‰²æ ‡è¯†ï¼ˆç»¿ >30d, é»„ <7d, çº¢ <24hï¼‰
- [ ] è¿‡æœŸ Token è‡ªåŠ¨æ ‡è®°

#### 2.2 åˆ†ç±»ä¸æœç´¢

- [ ] æ ‡ç­¾ç³»ç»Ÿï¼ˆProd, Test, CI/CD ç­‰ï¼‰
- [ ] å®æ—¶æ¨¡ç³Šæœç´¢ï¼ˆæŒ‰å¹³å°ã€ç”¨é€”ã€æ ‡ç­¾ï¼‰
- [ ] æŒ‰çŠ¶æ€/æ ‡ç­¾è¿‡æ»¤

#### 2.3 æƒé™æ¸…å•

- [ ] Scope å¯Œæ–‡æœ¬è®°å½•åŒºåŸŸ
- [ ] Tag å½¢å¼å±•ç¤ºæƒé™
- [ ] å¸¸è§å¹³å° Scope é¢„è®¾æ¨¡æ¿

**éªŒæ”¶æ ‡å‡†**ï¼š

- ç”¨æˆ·å¯ä»¥ç§’çº§æœç´¢åˆ°ç›®æ ‡ Token
- ä¸€çœ¼è¯†åˆ« Token å‰©ä½™å¯¿å‘½
- æ¸…æ™°è®°å½•æ¯ä¸ª Token çš„æƒé™èŒƒå›´

---

### Phase 3: è‡ªåŠ¨åŒ–æé†’

**ç›®æ ‡**ï¼šè§£å†³ã€Œè¿‡æœŸè€Œä¸è‡ªçŸ¥ã€çš„ç—›ç‚¹

#### 3.1 é‚®ä»¶ç³»ç»Ÿé›†æˆ

- [ ] é…ç½® Resend API
- [ ] è®¾è®¡ HTML é‚®ä»¶æ¨¡æ¿
- [ ] å®ç°é‚®ä»¶å‘é€æœåŠ¡

#### 3.2 åå°æ‰«æä»»åŠ¡

- [ ] æ¯æ—¥å‡Œæ™¨ Cron ä»»åŠ¡
- [ ] æ‰«æ Expires At < 7 days çš„è®°å½•
- [ ] è‡ªåŠ¨å‘é€æé†’é‚®ä»¶
- [ ] æ ‡è®°å·²å‘é€æé†’ï¼ˆreminded å­—æ®µï¼‰

#### 3.3 å®‰å…¨å®¡è®¡æ—¥å¿—

- [ ] è®°å½• Token æœ€åè¯»å–æ—¶é—´
- [ ] è¯†åˆ«é•¿æœŸæœªç”¨ Tokenï¼ˆ>1 å¹´ï¼‰
- [ ] æä¾›æ¸…ç†å»ºè®®

**éªŒæ”¶æ ‡å‡†**ï¼š

- è¿‡æœŸå‰ 7 å¤©è‡ªåŠ¨å‘é€é‚®ä»¶æé†’
- é‚®ä»¶åŒ…å«å³å°†è¿‡æœŸçš„ Token åˆ—è¡¨åŠç”¨é€”
- ç”¨æˆ·å¯ä»¥è¯†åˆ«å¹¶æ¸…ç†é—²ç½® Token

---

### Phase 4: å¼€å‘è€…ä½“éªŒå¢å¼º

**ç›®æ ‡**ï¼šæ— ç¼å¯¹æ¥å·¥ä½œæµ

#### 4.1 å¯¼å‡ºåŠŸèƒ½

- [ ] å¯¼å‡ºä¸º `.env` æ ¼å¼
- [ ] å¯¼å‡ºä¸º `export TOKEN=...` æ ¼å¼
- [ ] é€‰æ‹©æ€§å¯¼å‡ºï¼ˆæŒ‰æ ‡ç­¾è¿‡æ»¤ï¼‰

#### 4.2 æš—é»‘æ¨¡å¼

- [ ] å®Œæ•´æ”¯æŒæ˜/æš—ä¸»é¢˜åˆ‡æ¢
- [ ] ç³»ç»Ÿä¸»é¢˜è‡ªåŠ¨æ£€æµ‹

#### 4.3 CLI æ¡¥æ¥ï¼ˆå¯é€‰ï¼‰

- [ ] æç®€å‘½ä»¤è¡Œå·¥å…·
- [ ] æ”¯æŒ `1token get <platform>` è°ƒå– Token
- [ ] è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿

**éªŒæ”¶æ ‡å‡†**ï¼š

- å¼€å‘è€…å¯ä¸€é”®å¯¼å‡ºå·¥ä½œåŒºæ‰€éœ€ Token
- æ”¯æŒæš—é»‘æ¨¡å¼
- ï¼ˆå¯é€‰ï¼‰å‘½ä»¤è¡Œå¿«é€Ÿè·å– Token

---

## ğŸ— æ•°æ®æ¨¡å‹ (Prisma Schema)

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Token {
  id           String   @id @default(cuid())
  platform     String   // å¹³å°åç§°ï¼šGitHub, PyPI, AWS ç­‰
  encryptedVal String   // AES-256-GCM åŠ å¯†åçš„ Base64 å¯†æ–‡
  iv           String   // åŠ å¯†åˆå§‹åŒ–å‘é‡
  authTag      String   // GCM è®¤è¯æ ‡ç­¾
  purpose      String   // ç”¨é€”æè¿°
  scopes       String?  // æƒé™èŒƒå›´ï¼ˆJSON å­—ç¬¦ä¸²æˆ–é€—å·åˆ†éš”ï¼‰
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  expiresAt    DateTime? // è¿‡æœŸæ—¶é—´
  lastUsed     DateTime? // æœ€åä½¿ç”¨æ—¶é—´
  tags         String   // æ ‡ç­¾ï¼Œé€—å·åˆ†éš”
  reminded     Boolean  @default(false) // æ˜¯å¦å·²å‘é€è¿‡æœŸæé†’
  isActive     Boolean  @default(true)  // æ˜¯å¦æ¿€æ´»
}
```

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

1. **Master Password ä¸è½åº“**ï¼šä»…å­˜å‚¨ bcrypt å“ˆå¸Œï¼Œæ´¾ç”Ÿå¯†é’¥å­˜äº Session
2. **å‰ç«¯é®è”½**ï¼šToken é»˜è®¤æ˜¾ç¤º `********`ï¼Œç‚¹å‡»/å¤åˆ¶æ—¶è§£å¯†
3. **åŠ å¯†æ—¶æœº**ï¼šToken åœ¨æœåŠ¡ç«¯åŠ å¯†åå…¥åº“ï¼Œè§£å¯†ä»…åœ¨å†…å­˜ä¸­è¿›è¡Œ
4. **Session è¿‡æœŸ**ï¼šç”¨æˆ·ç™»å‡ºæˆ– Session è¿‡æœŸåç«‹å³é”€æ¯æ´¾ç”Ÿå¯†é’¥
5. **æ—¥å¿—è„±æ•**ï¼šç¦æ­¢è®°å½•ä»»ä½• Token æ˜æ–‡

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
1token/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”œâ”€â”€ dashboard/         # ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ login/             # ç™»å½•é¡µ
â”‚   â””â”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # Shadcn åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ token/            # Token ç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ crypto.ts         # åŠ å¯†/è§£å¯†
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯é€»è¾‘
â”‚   â””â”€â”€ db.ts             # Prisma å®¢æˆ·ç«¯
â”œâ”€â”€ prisma/               # æ•°æ®åº“
â”‚   â””â”€â”€ schema.prisma     # Schema å®šä¹‰
â”œâ”€â”€ scripts/              # è„šæœ¬
â”‚   â””â”€â”€ cron.ts           # å®šæ—¶ä»»åŠ¡
â””â”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
```

---

## ğŸ“ å¼€å‘è®°å½•

- **2026-02-28**: é¡¹ç›®åˆå§‹åŒ–ï¼Œå®Œå–„ Roadmap æ–‡æ¡£
